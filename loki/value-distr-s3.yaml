nameOverride: loki
fullnameOverride: loki

serviceAccount:
  create: false
serviceMonitor:
  enabled: false
prometheusRule:
  enabled: false
loki:
  config: |
    auth_enabled: false

    server:
      http_listen_port: 3100
      grpc_listen_port: 9095
      http_server_write_timeout: 310s
      http_server_read_timeout: 310s
      grpc_server_max_recv_msg_size: 104857600  # 100 Mb
      grpc_server_max_send_msg_size: 104857600  # 100 Mb

    common:
      compactor_address: http://loki-compactor:3100
      path_prefix: /var/loki
      replication_factor: 1
      storage:
        s3:
          access_key_id: admin
          bucketnames: chunks
          endpoint: minio-svc.minio.svc:9000
          insecure: true
          s3forcepathstyle: true
          secret_access_key: password  
          

    compactor:
      shared_store: s3

    distributor:
      ring:
        kvstore:
          store: memberlist

    frontend:
      compress_responses: true
      log_queries_longer_than: 5s
      tail_proxy_url: http://loki-querier.loki.svc:3100

    frontend_worker:
      frontend_address: loki-query-frontend-headless.loki.svc:9095

    ingester:
      chunk_block_size: 262144
      chunk_encoding: snappy
      chunk_idle_period: 30m
      chunk_retain_period: 1m
      lifecycler:
        ring:
          kvstore:
            store: memberlist
          replication_factor: 1
      max_transfer_retries: 0
      wal:
        dir: /var/loki/wal


    limits_config:
      ingestion_rate_mb: 20
      ingestion_burst_size_mb: 30  
      per_stream_rate_limit: "3MB"
      per_stream_rate_limit_burst: "10MB"  
      enforce_metric_name: false
      max_cache_freshness_per_query: 10m
      reject_old_samples: true
      reject_old_samples_max_age: 168h
      split_queries_by_interval: 15m

    memberlist:
      join_members:
      - loki-memberlist:7946


    query_range:
      parallelise_shardable_queries: false
      align_queries_with_step: true
      cache_results: true
      max_retries: 5
      results_cache:
        cache:
          embedded_cache:
            enabled: true
            ttl: 24h

    ruler:
      alertmanager_url: https://alertmanager.xx
      rule_path: /tmp/loki/scratch
      storage:
        s3:
          bucketnames: ruler
        type: s3

    runtime_config:
      file: /var/loki-runtime/runtime.yaml

    schema_config:
      configs:
      - from: "2020-09-07"
        index:
          period: 24h
          prefix: loki_index_
        object_store: s3
        schema: v12
        store: boltdb-shipper    
    
    storage_config:
      boltdb_shipper:
        active_index_directory: /var/loki/index
        cache_location: /var/loki/cache
        cache_ttl: 168h
        shared_store: s3      

ingester:
  replicas: 1

distributor:
  replicas: 1

querier:
  replicas: 1

queryFrontend:
  replicas: 1


gateway:
  enabled: true
  replicas: 1

compactor:
  enabled: true

ruler:
  enabled: true






